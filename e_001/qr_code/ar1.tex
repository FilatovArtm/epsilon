\documentclass[8pt]{article}

%%%  Не трогайте шаманские заклинания без спросу!
\usepackage[cp1251]{inputenc}
\usepackage[russian]{babel}
\usepackage[pdftex,unicode,colorlinks=true,urlcolor=blue,hyperindex,breaklinks]{hyperref}
\usepackage{listings}
\usepackage{multicol}
\usepackage[usenames,dvipsnames]{xcolor}


\usepackage[paper=a4paper,top=13.5mm, bottom=13.5mm,left=16.5mm,right=13.5mm,includefoot]{geometry}
\usepackage[pdftex,unicode,colorlinks=true,urlcolor=blue,hyperindex,breaklinks]{hyperref} 
\usepackage{fancyhdr} % Колонтитулы
\usepackage{graphicx}
  \pagestyle{fancy}
\usepackage{euscript}   % Шрифт Евклид
\usepackage{mathrsfs} % Красивый матшрифт
\usepackage{longtable}  % Длинные таблицы
\usepackage{multirow} % Слияние строк в таблице
\usepackage{floatflt}% Обтекаемые таблицы


\begin{document}
 
\par QR-код или немного о дополненной реальности
\medskip\hrule height 1pt\vskip 1pt\hrule\medskip
\par Что позволяет порядочному исследователю творить? Совесть? - возможно, но здесь не об этом, здесь все серьезно. Это данные. Сегодня они нужны всем, ведь, так или иначе, любой эконометрический анализ, как и множество исследований, без этого ключевого элемента становится невозможным или остается узником чистой и неприменимой теории. Вот так, в поисках релевантных временных рядов, всевозможных панелей, да просто данных, мы скитаемся по интернету: www.fira.ru, незаменимый www.gks.ru, просматриваем различные базы OECD, RUSLANA, СПАРК. Впрочем, это не новость, собственно и заметка не совсем об этом. Все дело в том, что мало кто замечает, данные --- они повсюду, нужно только заглянуть несколько глубже, заглянуть в дополненную реальность. 
 \par После того, как необходимый, хоть и минимальный, отсыл к эконометрике, ввиду тематики журнала, был соблюден, самое время поговорить об этой самой дополненной реальности, где окружающий нас мир соприкасается с миром виртуальным.
\par Почему именно дополненная реальность? Просто мне всегда казалось, что это слишком сложно, чтобы быть правдой. Возможно, для девушек это вполне нормально, когда компьютер --- почти как магия.
\begin{floatingfigure}{90mm}
\noindent
\hfil
\includegraphics[width=90mm]{C:/HSE/4course/R/1.jpg}
\hfil
\end{floatingfigure} Все началось с машинного зрения, для человека зрение настолько естественно, что большинство просто не задумывается, что кого-то, в данном случае что-то, нужно этому учить. И хотя многие современные компьютеры выглядят совсем не глупее людей, научить их видеть чрезвычайно непростая задача. Они должны не только уметь различать цвета, идентифицировать предметы, определять их границы и классифицировать, но и учитывать контекст, внутриклассовую изменчивость, масштаб, освещение, возможную деформацию при движении, изменении ракурса и положения, отличать, к примеру, отбрасываемую тень от самого предмета.\begin{floatingfigure}{123mm}
\noindent
\hfil
\includegraphics[width=79mm]{C:/HSE/4course/R/tt.jpg}\includegraphics[width=44mm]{C:/HSE/4course/R/dd.jpg}
\hfil
\end{floatingfigure} Однако мир не без умных людей, и современные алгоритмы, так или иначе, позволяют решать эти проблемы. Применимость компьютерного зрения весьма обширна: системы моделирования объектов и окружающей среды, к примеру, медицинских изображений, рентгенов, томографий, системы видеонаблюдения и организации информаций, а также системы дополненной реальности. С дополненной реальностью, несмотря на всю загадочность названия, сталкивался каждый, кто хоть раз смотрел различные спортивные мероприятия, будь то теннис, когда в случае спорных моментов моделируется траектория полета мяча, или футбол, где при определении офсайда возникает линия параллельная лицевой, которая позволяет определить ближайшего к воротам игрока.
\par Одна из разновидностей дополненной реальности это всем известные QR-коды и штрих коды. Несложно догадаться, где именно черпал вдохновение создатель штрих кодов, да, вы правы, в азбуке Морзе. Однако данные линейные коды вмещают слишком мало информации, по этой причине в 1994 году в Японии и были изобретены двухмерные или матричные коды. Самым популярным из которых и стал QR-код, что означает <<быстрый отклик>>. И, если у обычных шрих кодов объем памяти не превышал 100 байт, то у матричных кодов данный показатель значительно выше --- до 2048 байт\footnote{https://ru.wikipedia.org/wiki/Data\_Matrix}, более того информация может быть считана даже при 30\% повреждении метки!  
\par Что вызвало некое удивление относительно применения QR-кодов, так это использование последних на кладбищах в Японии и Австрии для хранения информации об усопшем, впрочем, вернемся к основным техническим характеристикам. Самый маленький QR-код имеет размер 21х21 пиксель, в то время как, самый большой (версия 40) — 177х177 пикселей. Что касается кодировки QR-кодов, то существует 4 основных типа: цифровая (до 7089 цифр), алфавитно-цифровая (до 4296 символов), байтовая(до 2953 байт), кандзи (до 1817 иероглифов)\footnote{https://ru.wikipedia.org/wiki/QR}.
\par Так или иначе, каждому не раз приходилось сталкиваться с QR-кодами в жизни, некоторым даже использовали смартфоны, чтобы считать код. Но вряд ли кому-то приходило в голову делать это вручную. А так как в жизни бывают разные ситуации, почему бы не восполнить данный пробел?
\par Для начала разберемся, как устроен QR-код. Изначально данные, которые нужно закодировать, разбиваются на блоки в зависимости от режима кодирования, далее прибавляется заголовок, указывающий режим и количество блоков. Безусловно, существуют режимы с более сложной структурой кодирования, однако из них весьма проблематично извлекать информацию вручную, поэтому остановимся на более простых случаях. После того, как записаны все информационные данные, к ним добавляются корректирующие ошибки коды Рида-Соломона (RS), которые позволяют исправлять недочеты при чтении. Именно эти коды и занимают большую часть QR матрицы. Перед записью в картинку данные  с RS-кодами перемешиваются, для чего используются специальные маски. Среди имеющихся 8 алгоритмов, которые представлены на рисунке справа, выбирается наилучший, который определяется засчет системы штрафов. После этой процедуры перемешанные данные записываются на шаблонную картинку, к которой добавляются техническая информация для декодирующих устройств\footnote{http://habrahabr.ru/post/127197/}.

\par Возможно, многие замечали, что QR-код можно разбить на несколько областей, у каждой из которых индивидуальные функции, что показано на рисунке слева. Так вот, три квадрата в углах изображения и меньшие синхронизирующие квадратики по всему коду и есть техническая информация для декодирующих устройств, которая позволяет нормализовать размер изображения и его ориентацию, а также угол, под которым сенсор расположен к поверхности изображения. Таким образом, как вы можете догадаться, эта область абсолютно неинтересна для нас, так как не содержат никакой информации о скрывающимся за кодом послании. Что касается полезной части кода, то ее можно разделить на две области: область, отвечающая за системную информацию, и непосредственнно за данные. Также в матрице содержится информация о версии кода, от которой зависит емкость последнего. Так, при повышении версии добавляются специальные блоки, при высоких версиях кода не рекомендуется считывать его вручную.

\par  Системная информация представляет собой 15 бит данных, из которых только 5 бит для нас значимы: 2 бита отвечают за уровень коррекции ошибок, а оставшиеся 3 --- применяемую к данным маску. Еще 10 бит данных это BCH код, который дает возможность исправлять ошибки в системных данных. Упомянутые ранее RS-коды, коды Рида-Соломона, также относятся к классу BCH. Помимо всего прочего, для дополнительной защиты системной информации используется статическая маска, применяемая к любой системной информации. Она имеет вид: 101010000010010. А так как нам интересны только первые 5 бит, то маску можно сократить и уже не так сложно запомнить: 10101. Как видно из рисунка, системная информация, отмеченная красным цветом, дублируется, что позволяет значительно понизить вероятность возникновения ошибок.

\begin{figure}
\noindent 
\begin{minipage}[c]{90mm} 
\includegraphics[width=90mm]{C:/HSE/4course/R/qr1.png} 
\label{figLeft}
\end{minipage}
\hfill 
\begin{minipage}[c]{90mm} 
\includegraphics[width=90mm]{C:/HSE/4course/R/qr2.png}
\label{figRight}
\end{minipage}
\end{figure}

\par Таким образом, {\bf первый шаг --- чтение первых 5 бит системной информации}.
\begin{floatingfigure}{100mm}
\noindent
\hfil
\includegraphics[width=90mm]{C:/HSE/4course/R/1.png}
\hfil
\end{floatingfigure}
\par Для лучшего понимания, воспользуемся кодом, сгенерированным на  {\it QR Coder.ru}. Получили, что для нашего кода уровень коррекции ошибок --- 00 --- уровень М, позволяющий скорректировать до 15\% ошибок, маска --- 101, соответствующая 8 картинке на рисунке (3 ряд, справа). Все возможные варианты масок и уровней коррекции представлены в таблице 1.

\newpage
\par {\bf Шаг второй --- определение режима кодировки}.
\begin{floatingfigure}{90mm}
\noindent
\hfil
\includegraphics[width=90mm]{C:/HSE/4course/R/21.png}
\hfil
\end{floatingfigure}

\par Чтобы понять с какими данными предстоит иметь дело, необходимо изначально прочитать 4-х битный заголовок, который содержит в себе информацию о режиме. Заголовок находится в правом нижнем углу матрицы, причем читать его надо змейкой, начиная справа. После извлечения 4-х бит, описывающих режим, необходимо применить к ним маску. Маска определяется выражением, приведенным в таблице, в нашем случае --- {\it (i j) mod 2 + (i j) mod 3 = 0} . Если данное выражение сводится к {\it TRUE} для бита с координатами (i,j), то бит инвертируется, иначе все остается без изменений. Начало координат в левом верхнем углу (0,0), в матрице 21х21 бит, квадрат, таким образом, бит, находящийся в правом нижнем углу имеет координаты (20,20). Получили 0100, что соответствует 8-битному режиму.

\par{\bf Шаг третий --- теперь можно читать данные}.
\begin{floatingfigure}{90mm}
\noindent
\hfil
\includegraphics[width=90mm]{C:/HSE/4course/R/31.png}
\hfil
\end{floatingfigure}
\par Необходимость определения режима кодирования обуславливается тем, что от него зависит длина блоков данных, которая также варьируется для различных версий кода. Для 1 - 9 версии кода: в числовом режиме используются 10-битные или 4-х битные блоки, если в 10-битном объёме нет необходимости, в буквенно-числовом режиме --- 9-битные блоки, при 8-битном (байтном) режиме --- 8-битные блоки. Причем первым блок после указателя режима --- это количество символов. Таким образом, для определения количества символов расшифровываем следующие 8 бит кода (змейком, начиная справа) и применяем маску. Видно, что в коде зашифровано 4 символа, поэтому необходимо перейти к чтению следующего столбца для извлечения всех 4-х блоков информации.

\begin{floatingfigure}{90mm}
\noindent
\hfil
\includegraphics[width=90mm]{C:/HSE/4course/R/41.png}
\hfil
\end{floatingfigure}
\par Снова считываем данные по такому же алгоритму, главное отличие --- биты надо отсчитывать змейкой, но с правого верхнего угла. Далее полученный набор из 0 и 1 делим на 4 блока по 8 бит в каждом. Текст в 8-битном режиме многие онлайн генераторы QR кодируют, используя {\it ASCII}. Таким образом, первые 4 элемента блока указывают на регистр, 0110 соответствует нижнему регистру букв, 0100 --- верхнему, вторые 4 элемента --- это число, равное номеру буквы в алфавите. Как можно заметить, все наши буквы --- маленькие, далее получаем числа 5, 3, 15 и 14, и находим нужные нам буквы. Так, в коде была зашифрована часть слова, а именно {\bf econ}, а какого именно слова economics или econometrics, или что-то еще --- пусть каждый решает для себя сам!
\medskip
\par {\it p.s. просто слишком длинное слово было бы лень расшифровывать.}
\begin{table}[ht]
\caption{}
\label{} 
\centering
\begin{tabular}{||c|l||}
\hline 
\multicolumn{2}{|c|}{\bf Возможные маски}\\ 
\hline
{\bf 000} & (i + j) mod 2 = 0\\
{\bf 001} & i mod 2 = 0\\
{\bf 010}	& j mod 3 = 0\\
{\bf 011}	& (i + j) mod 3 = 0\\
{\bf 100}	& ((i div 2) + (j div 3)) mod 2 = 0\\
{\bf 101}	& (i j) mod 2 + (i j) mod 3 = 0\\
{\bf 110}	& ((i j) mod 2 + (i j) mod 3) mod 2 = 0\\
{\bf 111}	& ((i+j) mod 2 + (i j) mod 3) mod 2 = 0\\
\hline 
\multicolumn{2}{|c|}{\bf Возможные уровни коррекции ошибок}\\  
\hline
{\bf  01} & L\\
{\bf  00} & M\\
{\bf  11} & Q\\
{\bf  10} & H\\
\hline
\multicolumn{2}{|c|}{\bf Возможные режимы}\\  
\hline
{\bf  0111} & ECI\\
{\bf  0001} & Числовые\\
{\bf  0010} & Буквенно-числовые\\
{\bf  0100} & 8-битный (байтный)\\
{\bf  1000} & Kanji\\
{\bf  0011} & Структурированное дополнение\\
{\bf  0101} & FNC1 (1-я позиция)\\
{\bf  1001} & FNC1 (2-я позиция)\\
\hline
\end{tabular}
\end{table}

\begin{center}
\includegraphics[width=120mm]{C:/HSE/4course/R/qr.jpg} 
\end{center}

\end{document}